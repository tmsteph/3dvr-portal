<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3DVR Portal – Calendar Hub</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles/global.css">
  <link rel="stylesheet" href="/calendar/calendar.css">
</head>
<body class="calendar-page">
  <header class="calendar-header">
    <a class="calendar-header__back" href="../index.html">⬅ Back to Portal</a>
    <h1 class="calendar-header__title">Calendar Hub</h1>
    <p class="calendar-header__subtitle">
      Manage your schedule directly in the portal. Events live in your local calendar first, with optional
      syncs to Google or Outlook when you need them.
    </p>
  </header>

  <main class="calendar-shell">
    <section class="panel" aria-labelledby="local-calendar-title">
      <div class="panel__header">
        <h2 id="local-calendar-title">My local calendar</h2>
        <p class="panel__intro">
          Add events that stay in this browser by default. When you want to share them with another service,
          you can trigger an optional sync without leaving this page.
        </p>
      </div>

      <form class="create-event-form" id="create-event-form">
        <div class="create-event-form__row">
          <label class="field">
            <span class="field__label">Title</span>
            <input type="text" name="title" required placeholder="Sprint planning">
          </label>
          <label class="field">
            <span class="field__label">Start</span>
            <input type="datetime-local" name="start" required>
          </label>
          <label class="field">
            <span class="field__label">End</span>
            <input type="datetime-local" name="end" required>
          </label>
        </div>
        <div class="create-event-form__row">
          <label class="field">
            <span class="field__label">Timezone</span>
            <input type="text" name="timeZone" required>
          </label>
          <label class="field">
            <span class="field__label">Description</span>
            <textarea name="description" rows="3" placeholder="Add agenda and dial-in details"></textarea>
          </label>
        </div>

        <fieldset class="create-event-form__sync">
          <legend>Optional sync</legend>
          <p>Select the services that should also receive this event after it is stored locally.</p>
          <label class="chip">
            <input type="checkbox" name="syncProviders" value="google">
            <span>Google</span>
          </label>
          <label class="chip">
            <input type="checkbox" name="syncProviders" value="outlook">
            <span>Outlook</span>
          </label>
        </fieldset>

        <button type="submit">Save event</button>
      </form>

      <section class="calendar-visual" aria-labelledby="calendar-visual-title">
        <div class="calendar-visual__header">
          <button
            type="button"
            class="calendar-visual__nav button-secondary"
            data-calendar-nav="prev"
            aria-label="Show previous month"
          >
            ‹
          </button>
          <div class="calendar-visual__title-group">
            <h3 id="calendar-visual-title" data-calendar-title></h3>
            <p class="calendar-visual__hint">Events saved locally appear on this monthly snapshot.</p>
          </div>
          <button
            type="button"
            class="calendar-visual__nav button-secondary"
            data-calendar-nav="next"
            aria-label="Show next month"
          >
            ›
          </button>
        </div>
        <p class="calendar-visual__live" aria-live="polite" data-calendar-live></p>
        <div class="calendar-visual__weekdays" aria-hidden="true">
          <span data-calendar-weekday="0">Sun</span>
          <span data-calendar-weekday="1">Mon</span>
          <span data-calendar-weekday="2">Tue</span>
          <span data-calendar-weekday="3">Wed</span>
          <span data-calendar-weekday="4">Thu</span>
          <span data-calendar-weekday="5">Fri</span>
          <span data-calendar-weekday="6">Sat</span>
        </div>
        <div class="calendar-visual__grid" role="grid" aria-labelledby="calendar-visual-title" data-calendar-grid></div>
      </section>

      <div class="event-results" aria-live="polite">
        <div class="event-results__empty" data-empty>
          <p>No events yet. Add one above or import from Google/Outlook when you're ready.</p>
        </div>
        <ul class="event-results__list" data-event-list></ul>
      </div>

      <div class="log" aria-live="polite" data-log></div>
    </section>

    <section class="panel" aria-labelledby="connections-title">
      <div class="panel__header">
        <h2 id="connections-title">Optional account connections</h2>
        <p class="panel__intro">
          Authenticate with Google or Outlook using OAuth and paste the access token below. We store the
          values locally so you can quickly reconnect while developing the integration.
        </p>
      </div>

      <div class="connection-grid">
        <article class="connection-card" aria-labelledby="google-connection-title">
          <div class="connection-card__header">
            <h3 id="google-connection-title">Google Calendar</h3>
            <span class="connection-card__status" data-status="google">Disconnected</span>
          </div>
          <form class="connection-card__form" data-provider="google">
            <label class="field">
              <span class="field__label">Access token</span>
              <textarea name="accessToken" rows="3" required placeholder="ya29.a0AWY..." aria-describedby="google-token-help"></textarea>
            </label>
            <label class="field">
              <span class="field__label">Calendar ID (optional)</span>
              <input type="text" name="calendarId" placeholder="primary">
            </label>
            <p class="field__help" id="google-token-help">
              Generate tokens via Google OAuth 2.0. Use a test project and enable the Calendar API. Tokens
              are saved in your browser only.
            </p>
            <div class="connection-card__actions">
              <button type="submit">Save connection</button>
              <button type="button" class="button-secondary" data-action="disconnect" data-provider="google">Disconnect</button>
            </div>
          </form>
          <details class="connection-card__details">
            <summary>Need help?</summary>
            <ol>
              <li>Create an OAuth 2.0 client in the Google Cloud console.</li>
              <li>Authorize the playground or your dev app with the <code>https://www.googleapis.com/auth/calendar</code> scope.</li>
              <li>Paste the returned <strong>access_token</strong> here. Refresh tokens can be rotated manually for now.</li>
            </ol>
          </details>
        </article>

        <article class="connection-card" aria-labelledby="outlook-connection-title">
          <div class="connection-card__header">
            <h3 id="outlook-connection-title">Outlook / Microsoft 365</h3>
            <span class="connection-card__status" data-status="outlook">Disconnected</span>
          </div>
          <form class="connection-card__form" data-provider="outlook">
            <label class="field">
              <span class="field__label">Access token</span>
              <textarea name="accessToken" rows="3" required placeholder="EwBwA8l6B..." aria-describedby="outlook-token-help"></textarea>
            </label>
            <label class="field">
              <span class="field__label">Mailbox (optional)</span>
              <input type="email" name="mailbox" placeholder="user@contoso.com">
            </label>
            <p class="field__help" id="outlook-token-help">
              Create an Azure AD app registration with Calendars.ReadWrite delegated permissions and paste the
              access token here. Microsoft Graph endpoints are proxied through our API folder.
            </p>
            <div class="connection-card__actions">
              <button type="submit">Save connection</button>
              <button type="button" class="button-secondary" data-action="disconnect" data-provider="outlook">Disconnect</button>
            </div>
          </form>
          <details class="connection-card__details">
            <summary>Need help?</summary>
            <ol>
              <li>Register a single-page application in Azure.</li>
              <li>Grant delegated permissions for <code>Calendars.ReadWrite</code> and <code>offline_access</code>.</li>
              <li>Use the OAuth 2.0 authorization code flow to fetch tokens, then paste the <strong>access_token</strong> here.</li>
            </ol>
          </details>
        </article>
      </div>
    </section>

    <section class="panel" aria-labelledby="event-sync-title">
      <div class="panel__header">
        <h2 id="event-sync-title">Import from external calendars</h2>
        <p class="panel__intro">
          Pull events from connected providers when you want to copy them into your local calendar. Choose a
          provider below to start an import.
        </p>
      </div>

      <form class="sync-controls" id="event-sync-form">
        <fieldset class="sync-controls__group">
          <legend>Provider</legend>
          <label class="chip">
            <input type="radio" name="provider" value="google" checked>
            <span>Google</span>
          </label>
          <label class="chip">
            <input type="radio" name="provider" value="outlook">
            <span>Outlook</span>
          </label>
        </fieldset>

        <fieldset class="sync-controls__group">
          <legend>Time range</legend>
          <label class="field">
            <span class="field__label">From</span>
            <input type="datetime-local" name="timeMin">
          </label>
          <label class="field">
            <span class="field__label">To</span>
            <input type="datetime-local" name="timeMax">
          </label>
          <label class="field">
            <span class="field__label">Max events</span>
            <input type="number" name="maxResults" min="1" max="100" value="20">
          </label>
        </fieldset>

        <div class="sync-controls__actions">
          <button type="button" data-action="fetch-events">Import events</button>
          <button type="button" data-action="refresh-status">Refresh status</button>
        </div>
      </form>
    </section>
  </main>

  <template id="event-template">
    <li class="event-card">
      <div class="event-card__header">
        <h3 data-field="title"></h3>
        <span class="event-card__provider" data-field="provider"></span>
      </div>
      <dl class="event-card__meta">
        <div>
          <dt>Starts</dt>
          <dd data-field="start"></dd>
        </div>
        <div>
          <dt>Ends</dt>
          <dd data-field="end"></dd>
        </div>
      </dl>
      <p class="event-card__description" data-field="description"></p>
      <div class="event-card__footer">
        <a class="event-card__link" data-field="link" href="#" target="_blank" rel="noreferrer noopener">Open in calendar</a>
        <button type="button" class="event-card__delete button-secondary" data-action="delete-event">Remove</button>
      </div>
    </li>
  </template>

  <script src="/calendar/calendar.js" type="module"></script>
</body>
</html>
