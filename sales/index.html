<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3dvr Sales Directory</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="/gun-init.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
  <script src="/score.js"></script>
</head>
<body class="bg-slate-950 text-slate-100 font-sans">
  <header class="bg-gradient-to-br from-blue-900 via-blue-800 to-purple-900 text-white">
    <div class="max-w-6xl mx-auto px-6 py-8 flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div>
        <p class="uppercase tracking-[0.3em] text-xs text-blue-200">3dvr.tech</p>
        <h1 class="text-3xl font-bold mt-2">Founder Revenue Launchpad</h1>
        <p class="text-sm text-blue-100 mt-1">Jump straight into CRM, contacts, calendar, and more to keep momentum high.</p>
      </div>
      <nav class="flex flex-wrap gap-2 text-sm">
        <a href="../contacts/index.html" class="bg-white/10 hover:bg-white/20 border border-white/10 text-white px-4 py-2 rounded-lg transition">Contacts Workspace</a>
        <a href="../crm/index.html" class="bg-white/10 hover:bg-white/20 border border-white/10 text-white px-4 py-2 rounded-lg transition">CRM</a>
        <a href="../calendar" class="bg-white/10 hover:bg-white/20 border border-white/10 text-white px-4 py-2 rounded-lg transition">Calendar</a>
        <a href="../index.html" class="bg-white/10 hover:bg-white/20 border border-white/10 text-white px-4 py-2 rounded-lg transition">Main Portal</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 py-10 space-y-10">
    <section id="sales-pitch" class="rounded-2xl bg-slate-900/70 border border-white/5 p-6 shadow-lg">
      <div class="flex flex-wrap items-start justify-between gap-4 mb-5">
        <div>
          <p class="text-xs uppercase tracking-[0.3em] text-blue-300">Recognition</p>
          <h2 class="text-xl font-semibold">Top Sales People</h2>
          <p class="text-sm text-slate-300 mt-2">Live rankings pulled from the portal so everyone can see who is leading from the front.</p>
        </div>
        <div class="text-right text-xs text-slate-400 space-y-1">
          <p class="font-semibold text-blue-200">Portal-backed data</p>
          <p id="sales-leaderboard-status">Syncing real performance...</p>
        </div>
      </div>
      <div id="sales-leaderboard-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
        <article class="rounded-xl border border-white/5 bg-slate-900/80 p-5 shadow-lg animate-pulse">
          <div class="h-4 w-24 rounded bg-white/10"></div>
          <div class="h-6 w-48 rounded bg-white/10 mt-3"></div>
          <div class="h-4 w-32 rounded bg-white/10 mt-2"></div>
          <div class="h-4 w-full rounded bg-white/10 mt-4"></div>
        </article>
      </div>
    </section>

    <section class="rounded-2xl bg-slate-900/70 border border-white/5 p-6 shadow-lg">
      <div class="flex flex-wrap items-start justify-between gap-4">
        <div>
          <p class="text-xs uppercase tracking-[0.3em] text-blue-300">Sales Pitch</p>
          <h2 class="text-xl font-semibold">Share the vision, invite micro-investors</h2>
          <p class="text-sm text-slate-300 mt-2 max-w-2xl">
            Use the dedicated pitch page to inspire subscribers with the mission, founder points incentive, and
            community-owned roadmap. It includes a ready-to-send outreach script.
          </p>
        </div>
        <a href="/sales/pitch.html" class="inline-flex items-center justify-center rounded-lg bg-white/10 border border-white/10 px-4 py-2 text-sm font-semibold text-white hover:bg-white/20">
          Open Sales Pitch Page
        </a>
      </div>
    </section>

    <section>
      <div class="flex items-center justify-between flex-wrap gap-4 mb-6">
        <h2 class="text-xl font-semibold">Explore Tools</h2>
        <p class="text-xs uppercase tracking-[0.3em] text-blue-300">Choose a workspace to dive in</p>
      </div>
      <p class="text-sm text-slate-300 max-w-3xl mb-6">Pick the workspace that matches what you need to move forward right now—manage deals, coordinate your calendar, organize contacts, and capture notes without losing momentum.</p>
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5">
        <a href="../crm/index.html" class="block rounded-2xl bg-slate-900/70 border border-white/5 p-5 shadow-lg transition hover:border-blue-400">
          <p class="text-xs uppercase tracking-wide text-blue-300">Deals</p>
          <h3 class="text-lg font-semibold mt-2">CRM</h3>
          <p class="text-sm text-slate-300 mt-3">Track opportunities, assign stages, and record progress in real time.</p>
        </a>
        <a href="training/" class="block rounded-2xl bg-slate-900/70 border border-white/5 p-5 shadow-lg transition hover:border-blue-400">
          <p class="text-xs uppercase tracking-wide text-blue-300">Skills</p>
          <h3 class="text-lg font-semibold mt-2">Sales Training</h3>
          <p class="text-sm text-slate-300 mt-3">Build your rapid pitch, sharpen offers, and rehearse follow-up flows in one workspace.</p>
        </a>
        <a href="../contacts/index.html" class="block rounded-2xl bg-slate-900/70 border border-white/5 p-5 shadow-lg transition hover:border-blue-400">
          <p class="text-xs uppercase tracking-wide text-blue-300">Network</p>
          <h3 class="text-lg font-semibold mt-2">Contacts Workspace</h3>
          <p class="text-sm text-slate-300 mt-3">Organize founders, champions, and investors with quick context tags.</p>
        </a>
        <a href="../calendar" class="block rounded-2xl bg-slate-900/70 border border-white/5 p-5 shadow-lg transition hover:border-blue-400">
          <p class="text-xs uppercase tracking-wide text-blue-300">Schedule</p>
          <h3 class="text-lg font-semibold mt-2">Calendar</h3>
          <p class="text-sm text-slate-300 mt-3">Plan your week, stack critical meetings, and protect focus time.</p>
        </a>
        <a href="/tasks/" class="block rounded-2xl bg-slate-900/70 border border-white/5 p-5 shadow-lg transition hover:border-blue-400">
          <p class="text-xs uppercase tracking-wide text-blue-300">Execution</p>
          <h3 class="text-lg font-semibold mt-2">Tasks</h3>
          <p class="text-sm text-slate-300 mt-3">Break goals into next steps and work straight from prioritized lists.</p>
        </a>
        <a href="../notes.html" class="block rounded-2xl bg-slate-900/70 border border-white/5 p-5 shadow-lg transition hover:border-blue-400">
          <p class="text-xs uppercase tracking-wide text-blue-300">Knowledge</p>
          <h3 class="text-lg font-semibold mt-2">Notes</h3>
          <p class="text-sm text-slate-300 mt-3">Store ideas, meeting takeaways, and playbooks for future launches.</p>
        </a>
        <a href="../index.html" class="block rounded-2xl bg-slate-900/70 border border-white/5 p-5 shadow-lg transition hover:border-blue-400">
          <p class="text-xs uppercase tracking-wide text-blue-300">Hub</p>
          <h3 class="text-lg font-semibold mt-2">Main Portal</h3>
          <p class="text-sm text-slate-300 mt-3">Jump to any workspace in the suite and stay aligned with the mission.</p>
        </a>
      </div>
    </section>

    <section class="rounded-2xl bg-gradient-to-br from-blue-700 via-blue-600 to-purple-700 p-8 shadow-xl text-center">
      <h2 class="text-2xl font-semibold">Ship Faster With the Suite</h2>
      <p class="text-sm text-blue-50 mt-3 max-w-2xl mx-auto">Set your priorities in tasks, capture insights in notes, and lock time on the calendar so every idea moves closer to launch.</p>
      <div class="mt-6 flex flex-wrap justify-center gap-3">
        <a href="/tasks/" class="inline-flex items-center justify-center rounded-lg bg-white text-blue-900 px-5 py-2.5 font-semibold shadow hover:bg-blue-50">Open Tasks</a>
        <a href="../notes.html" class="inline-flex items-center justify-center rounded-lg bg-blue-900/30 border border-white/30 px-5 py-2.5 text-sm font-semibold text-white hover:bg-blue-900/40">Review Notes</a>
      </div>
    </section>
  </main>

  <footer class="border-t border-white/10 bg-slate-950/80">
    <div class="max-w-6xl mx-auto px-6 py-8 text-center text-xs tracking-[0.3em] uppercase text-slate-500">
      &copy; 2025 3dvr.tech — Built for Builders
    </div>
  </footer>
  <script>
    (function initializeSalesLeaderboard() {
      const statusEl = document.getElementById('sales-leaderboard-status');
      const gridEl = document.getElementById('sales-leaderboard-grid');

      function createNodeStub() {
        if (window.ScoreSystem && typeof window.ScoreSystem.createGunNodeStub === 'function') {
          return window.ScoreSystem.createGunNodeStub();
        }
        return {
          get() {
            return this;
          },
          put() {
            return this;
          },
          once(callback) {
            if (typeof callback === 'function') {
              callback();
            }
            return this;
          },
          on() {
            return { off() {} };
          },
          map() {
            return { on() { return { off() {} }; } };
          }
        };
      }

      const peers = Array.isArray(window.__GUN_PEERS__) && window.__GUN_PEERS__.length
        ? window.__GUN_PEERS__
        : [
            'wss://relay.3dvr.tech/gun',
            'wss://gun-relay-3dvr.fly.dev/gun'
          ];

      const gunContext = window.ScoreSystem && typeof window.ScoreSystem.ensureGun === 'function'
        ? window.ScoreSystem.ensureGun(() => (typeof Gun === 'function'
          ? Gun({ peers, axe: true })
          : null), { label: 'sales-leaderboard' })
        : { gun: typeof Gun === 'function' ? Gun({ peers, axe: true }) : createNodeStub(), isStub: typeof Gun !== 'function' };

      const gun = gunContext.gun || null;
      const portalRoot = gun && typeof gun.get === 'function'
        ? gun.get('3dvr-portal')
        : createNodeStub();
      const userStats = portalRoot && typeof portalRoot.get === 'function'
        ? portalRoot.get('userStats')
        : createNodeStub();

      const records = {};
      let subscription = null;

      function formatRelativeTime(timestamp) {
        if (!timestamp) return 'moments ago';
        const now = Date.now();
        const diff = Math.max(0, now - timestamp);
        const minutes = Math.floor(diff / 60000);
        if (minutes < 1) return 'moments ago';
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;
        const days = Math.floor(hours / 24);
        return `${days}d ago`;
      }

      function renderLeaderboard() {
        const entries = Object.values(records)
          .filter(entry => entry && Number.isFinite(entry.points))
          .sort((a, b) => b.points - a.points)
          .slice(0, 6);

        if (!entries.length) {
          statusEl.textContent = gunContext.isStub
            ? 'Offline — showing placeholder until Gun connects.'
            : 'Waiting for portal stats to sync...';
          gridEl.innerHTML = `
            <article class="rounded-xl border border-white/10 bg-slate-900/80 p-5 shadow-lg">
              <p class="text-xs uppercase tracking-[0.25em] text-slate-400">No results yet</p>
              <h3 class="text-lg font-semibold mt-2">Portal data syncing</h3>
              <p class="text-sm text-slate-300 mt-2">Stay tuned—leaderboard updates automatically when sales stats arrive.</p>
            </article>
          `;
          return;
        }

        statusEl.textContent = gunContext.isStub
          ? 'Live data paused (offline mode).'
          : 'Pulled directly from portal user stats.';

        gridEl.innerHTML = entries.map((entry, index) => {
          const label = index === 0 ? '#1 Closer' : `#${index + 1} Rising`;
          const accent = index === 0
            ? 'border-blue-500/40 bg-gradient-to-br from-blue-800/60 via-blue-700/60 to-purple-800/50'
            : index === 1
              ? 'border-amber-400/50 bg-slate-900/80'
              : 'border-emerald-400/50 bg-slate-900/80';
          return `
            <article class="rounded-xl ${accent} p-5 shadow-lg border">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <p class="text-xs uppercase tracking-[0.25em] text-blue-200">${label}</p>
                  <h3 class="text-lg font-semibold">${entry.username || entry.alias}</h3>
                  <p class="text-sm text-slate-300 mt-1">${entry.alias || 'Anonymous builder'}</p>
                </div>
                <span class="inline-flex items-center rounded-full bg-white/15 px-3 py-1 text-xs font-semibold text-white">${entry.points} pts</span>
              </div>
              <p class="mt-3 text-sm text-slate-200">Last updated ${formatRelativeTime(entry.lastUpdated)} — broadcasting wins from the portal.</p>
            </article>
          `;
        }).join('');
      }

      function attachLeaderboard() {
        try {
          subscription = userStats.map().on((data, key) => {
            if (!key) return;
            if (!data) {
              delete records[key];
            } else {
              const points = Number(data.points || 0);
              records[key] = {
                alias: data.alias || key,
                username: data.username || key,
                points: Number.isFinite(points) ? points : 0,
                lastUpdated: data.lastUpdated || 0
              };
            }
            renderLeaderboard();
          });
        } catch (err) {
          console.warn('Failed to subscribe to sales leaderboard', err);
          statusEl.textContent = 'Unable to load portal stats right now.';
        }
      }

      attachLeaderboard();

      window.addEventListener('beforeunload', () => {
        if (subscription && typeof subscription.off === 'function') {
          subscription.off();
        }
      });
    })();
  </script>
</body>
</html>
