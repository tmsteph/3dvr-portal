<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Live Point Value • 3dvr.tech</title>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="../gun-init.js"></script>
    <link rel="stylesheet" href="../styles/global.css" />
    <link rel="stylesheet" href="../styles/points.css" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body class="points-page">
    <a class="skip-link" href="#mainContent">Skip to main content</a>

    <header class="points-hero">
      <div class="points-shell">
        <p class="points-eyebrow">Live payout preview</p>
        <h1>See the real point-to-dollar ratio</h1>
        <p class="points-intro">
          This dashboard pulls the current Stripe pool and total leaderboard points to estimate how much each point is worth
          right now. Refresh anytime to watch the value change as supporters subscribe and contributors earn.
        </p>
        <div class="points-cta">
          <a class="cta primary" href="../points.html">Back to points overview</a>
          <button class="cta ghost" type="button" id="ratioRefresh">Refresh live data</button>
        </div>
        <p class="ratio-live__status" id="ratioStatus" aria-live="polite">Loading live pool and leaderboard data...</p>
      </div>
    </header>

    <main id="mainContent" class="points-main">
      <section class="points-section">
        <div class="section-card ratio-card" aria-labelledby="liveRatioHeading">
          <div class="ratio-header">
            <div>
              <p class="points-eyebrow">Real-time math</p>
              <h2 id="liveRatioHeading">Point-to-dollar value</h2>
              <p class="info-note">
                Values update automatically when Stripe or the leaderboard changes. You can still adjust the numbers to model
                future growth scenarios.
              </p>
            </div>
            <div class="ratio-badge" aria-live="polite">
              <p class="ratio-badge-label">Dollar value per point</p>
              <p class="ratio-badge-value" id="ratioHighlight">$0.00</p>
            </div>
          </div>

          <div class="ratio-grid ratio-grid--condensed">
            <div class="ratio-stat">
              <p class="ratio-label">Stripe pool (USD)</p>
              <p class="ratio-value" id="poolDisplay">$0.00</p>
              <p class="ratio-hint" id="poolBreakdown">Waiting for Stripe to respond...</p>
            </div>
            <div class="ratio-stat">
              <p class="ratio-label">Total active points</p>
              <p class="ratio-value" id="totalPointsDisplay">0</p>
              <p class="ratio-hint">Summed from the live leaderboard</p>
            </div>
            <div class="ratio-stat">
              <p class="ratio-label">Updated at</p>
              <p class="ratio-value" id="liveUpdatedAt">—</p>
              <p class="ratio-hint">Timestamp of the last successful sync</p>
            </div>
          </div>

          <form class="ratio-form" aria-label="Point to dollar calculator">
            <div class="ratio-input">
              <label for="totalPoints">Total active points</label>
              <input id="totalPoints" name="totalPoints" type="number" min="0" step="1" value="0" />
            </div>
            <div class="ratio-input">
              <label for="poolDollars">Stripe pool (USD)</label>
              <input id="poolDollars" name="poolDollars" type="number" min="0" step="1" value="0" />
            </div>
            <div class="ratio-input">
              <label for="yourPoints">Your points to redeem</label>
              <input id="yourPoints" name="yourPoints" type="number" min="0" step="1" value="0" />
            </div>
          </form>

          <div class="ratio-grid" aria-live="polite">
            <div class="ratio-stat">
              <p class="ratio-label">Dollar value per point</p>
              <p class="ratio-value" id="dollarPerPoint">$0.00</p>
              <p class="ratio-hint">Pool divided by total active points</p>
            </div>
            <div class="ratio-stat">
              <p class="ratio-label">Points needed per dollar</p>
              <p class="ratio-value" id="pointsPerDollar">0</p>
              <p class="ratio-hint">Total points divided by pool</p>
            </div>
            <div class="ratio-stat">
              <p class="ratio-label">Potential cash-out</p>
              <p class="ratio-value" id="cashoutEstimate">$0.00</p>
              <p class="ratio-hint">Your points × dollar value per point</p>
            </div>
          </div>
        </div>
      </section>

      <section class="points-section">
        <div class="section-grid live-leaderboard">
          <article class="info-card">
            <h3>Top contributors</h3>
            <ol id="liveLeaderboard" class="leaderboard-list" aria-live="polite">
              <li class="leaderboard-list__item">Waiting for leaderboard data...</li>
            </ol>
          </article>
          <article class="info-card">
            <h3>How the live pool is calculated</h3>
            <ul>
              <li>Stripe balances come directly from <code>/api/stripe/metrics</code> and prefer USD when available.</li>
              <li>We add available and pending funds together to show the full pool backing point redemptions.</li>
              <li>Total points reflect the latest leaderboard entries stored in Gun.</li>
            </ul>
            <p class="info-note">If a currency other than USD is active, the page will display that currency code.</p>
          </article>
          <article class="info-card">
            <h3>Dollar value per person</h3>
            <p class="info-note">Uses the live pool and leaderboard totals to estimate each person’s share.</p>
            <div class="value-table" role="region" aria-live="polite">
              <div class="value-table__empty" id="valueTableEmpty">Waiting for pool and leaderboard data...</div>
              <table id="valueTable" class="value-table__table" aria-label="Point value per person">
                <thead>
                  <tr>
                    <th scope="col">Person</th>
                    <th scope="col">Points</th>
                    <th scope="col">Estimated value</th>
                  </tr>
                </thead>
                <tbody id="valueTableBody"></tbody>
              </table>
            </div>
          </article>
        </div>
      </section>
    </main>

    <footer class="points-footer">
      <p>Questions or ideas? Email <a href="mailto:hello@3dvr.tech">hello@3dvr.tech</a> and we will get back to you.</p>
    </footer>

    <script src="./pool-ratio.js" defer></script>
  </body>
</html>
